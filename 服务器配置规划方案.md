# 🖥️ AllData数据中台 - 服务器配置规划方案

## 📋 目录
- [一、整体架构概述](#一整体架构概述)
- [二、开发测试环境（最小化配置）](#二开发测试环境最小化配置)
- [三、生产环境（推荐配置）](#三生产环境推荐配置)
- [四、详细配置说明](#四详细配置说明)
- [五、成本预算](#五成本预算)
- [六、部署顺序建议](#六部署顺序建议)

---

## 一、整体架构概述

### 1.1 系统组件清单

根据文档，AllData数据中台包含以下核心组件：

#### **应用层**
- 前端系统（Vue 3 + Nginx）
- 后端API网关
- 用户认证服务

#### **数据管理层**
- Chat2DB（数据源平台）
- DBSwitch（数据库同步）
- DataCap（数据中枢）
- DataX/Transport（数据集成管理）
- TIS（数据集成平台）
- SeaTunnel（数据同步平台）

#### **大数据平台层**
- Hadoop（HDFS + YARN）
- Hive（数据仓库）
- Spark（批处理）
- Flink（实时计算）
- DataSophon（大数据集群管理）
- StreamPark（实时开发平台）

#### **存储层**
- MySQL（元数据存储）
- PostgreSQL（业务数据）
- Redis（缓存）
- Kafka（消息队列）
- ClickHouse/Doris（OLAP数据库）

#### **监控运维层**
- Prometheus + Grafana（监控）
- ELK（日志）
- Zookeeper（协调服务）

---

## 二、开发/测试环境（最小化配置）

### 💡 适用场景
- 个人学习
- 功能开发
- 小规模测试
- POC验证

### 🖥️ 服务器配置方案

#### **方案A：单机All-in-One（最低成本）**

**服务器数量**：1台

**配置要求**：
- **CPU**：16核（推荐AMD EPYC或Intel Xeon）
- **内存**：64GB DDR4
- **硬盘**：
  - 系统盘：200GB SSD
  - 数据盘：1TB SSD（或2TB HDD）
- **网络**：5Mbps带宽
- **操作系统**：CentOS 7.9 / Ubuntu 20.04 LTS

**部署组件**：
```
├── 前端 + Nginx（2GB内存）
├── 后端服务（8GB内存）
│   ├── Chat2DB
│   ├── DBSwitch
│   ├── DataCap
│   └── Transport
├── 数据库（20GB内存）
│   ├── MySQL 8.0
│   ├── Redis 6.x
│   └── PostgreSQL 14
├── 大数据组件（轻量级，30GB内存）
│   ├── Hadoop（伪分布式）
│   ├── Hive
│   ├── Spark Standalone
│   └── Flink Standalone
└── 监控（4GB内存）
    ├── Prometheus
    └── Grafana
```

**优点**：
- ✅ 成本最低（约500-800元/月）
- ✅ 部署简单
- ✅ 适合学习和开发

**缺点**：
- ❌ 性能有限
- ❌ 不支持高并发
- ❌ 无高可用

---

#### **方案B：3台服务器（推荐开发环境）**

**服务器数量**：3台

##### **服务器1：应用服务器**
- **CPU**：8核
- **内存**：32GB
- **硬盘**：500GB SSD
- **部署组件**：
  - 前端（Nginx）
  - 后端API服务
  - Chat2DB
  - DBSwitch
  - DataCap
  - Transport

##### **服务器2：数据库服务器**
- **CPU**：8核
- **内存**：32GB
- **硬盘**：1TB SSD
- **部署组件**：
  - MySQL 8.0（主）
  - PostgreSQL 14
  - Redis 6.x
  - Kafka（单节点）
  - Zookeeper

##### **服务器3：大数据服务器**
- **CPU**：16核
- **内存**：64GB
- **硬盘**：2TB HDD + 500GB SSD
- **部署组件**：
  - Hadoop（伪分布式）
  - Hive
  - Spark
  - Flink
  - ClickHouse/Doris
  - DataSophon
  - StreamPark

**总成本**：约1500-2500元/月

**优点**：
- ✅ 职责分离，性能更好
- ✅ 可以模拟生产环境
- ✅ 支持中等规模测试

**缺点**：
- ❌ 仍无高可用
- ❌ 大数据组件性能受限

---

## 三、生产环境（推荐配置）

### 💡 适用场景
- 企业生产环境
- 高并发场景
- 大数据量处理
- 需要高可用

### 🖥️ 服务器配置方案

#### **最小生产环境：7台服务器**

##### **1. 应用服务器集群（2台）**
**配置**：
- **CPU**：16核
- **内存**：64GB
- **硬盘**：500GB SSD
- **网络**：10Mbps

**部署组件**：
```
负载均衡（Nginx）
├── 前端静态资源
├── 后端API服务（主备）
├── Chat2DB
├── DBSwitch
├── DataCap
├── Transport
├── TIS
└── SeaTunnel
```

**高可用方案**：
- Nginx主备（Keepalived）
- 后端服务双活
- 服务注册中心（Nacos/Consul）

---

##### **2. 数据库服务器集群（2台）**
**配置**：
- **CPU**：16核
- **内存**：128GB
- **硬盘**：2TB SSD（RAID 10）
- **网络**：10Mbps

**部署组件**：
```
服务器1（主）：
├── MySQL 8.0（主）
├── PostgreSQL 14（主）
└── Redis Sentinel（主）

服务器2（从）：
├── MySQL 8.0（从）
├── PostgreSQL 14（从）
└── Redis Sentinel（从）
```

**高可用方案**：
- MySQL主从复制 + MHA
- PostgreSQL流复制 + Patroni
- Redis Sentinel哨兵模式

---

##### **3. 大数据集群（3台）**
**配置**：
- **CPU**：32核
- **内存**：256GB
- **硬盘**：
  - 系统盘：500GB SSD
  - 数据盘：10TB HDD（RAID 5）
- **网络**：10Gbps（万兆网卡）

**节点分配**：

**节点1（Master）**：
```
├── Hadoop NameNode（主）
├── YARN ResourceManager（主）
├── Hive Metastore
├── Spark Master
├── Flink JobManager
├── Kafka Broker 1
├── Zookeeper 1
└── DataSophon Server
```

**节点2（Standby Master）**：
```
├── Hadoop NameNode（备）
├── YARN ResourceManager（备）
├── Spark Master（备）
├── Flink JobManager（备）
├── Kafka Broker 2
├── Zookeeper 2
└── ClickHouse/Doris
```

**节点3（Worker）**：
```
├── Hadoop DataNode
├── YARN NodeManager
├── Spark Worker
├── Flink TaskManager
├── Kafka Broker 3
├── Zookeeper 3
└── ClickHouse/Doris
```

**高可用方案**：
- Hadoop HA（QJM）
- YARN HA
- Spark Standalone HA
- Flink HA（Zookeeper）
- Kafka集群（3副本）

---

##### **4. 监控运维服务器（1台）**
**配置**：
- **CPU**：8核
- **内存**：32GB
- **硬盘**：1TB SSD
- **网络**：5Mbps

**部署组件**：
```
├── Prometheus（监控）
├── Grafana（可视化）
├── Elasticsearch（日志存储）
├── Logstash（日志收集）
├── Kibana（日志查询）
├── AlertManager（告警）
└── Nacos/Consul（服务注册）
```

---

##### **5. 跳板机/堡垒机（可选，1台）**
**配置**：
- **CPU**：4核
- **内存**：8GB
- **硬盘**：200GB SSD

**用途**：
- 统一运维入口
- 操作审计
- 安全加固

---

## 四、详细配置说明

### 4.1 内存分配建议

#### **应用服务器（64GB）**
```
操作系统：8GB
Nginx：2GB
后端服务：
  - Chat2DB：8GB
  - DBSwitch：6GB
  - DataCap：8GB
  - Transport：6GB
  - TIS：6GB
  - SeaTunnel：6GB
预留：14GB
```

#### **数据库服务器（128GB）**
```
操作系统：8GB
MySQL：40GB
PostgreSQL：30GB
Redis：20GB
Kafka：20GB
预留：10GB
```

#### **大数据节点（256GB）**
```
操作系统：8GB
Hadoop：
  - NameNode：16GB
  - DataNode：32GB
YARN：
  - ResourceManager：8GB
  - NodeManager：64GB
Hive：16GB
Spark：64GB
Flink：32GB
Kafka：8GB
Zookeeper：4GB
预留：4GB
```

---

### 4.2 硬盘分配建议

#### **应用服务器（500GB SSD）**
```
/（根分区）：100GB
/var/log（日志）：100GB
/opt（应用）：200GB
/data（临时数据）：100GB
```

#### **数据库服务器（2TB SSD）**
```
/（根分区）：100GB
/var/lib/mysql：800GB
/var/lib/postgresql：600GB
/var/lib/redis：200GB
/var/log：100GB
备份空间：200GB
```

#### **大数据节点（10TB HDD + 500GB SSD）**
```
SSD（系统和热数据）：
  /（根分区）：100GB
  /opt：200GB
  /tmp：200GB

HDD（HDFS数据）：
  /data1：3.3TB
  /data2：3.3TB
  /data3：3.4TB
```

---

### 4.3 网络规划

#### **网络拓扑**
```
                    [公网]
                      |
                [负载均衡/防火墙]
                      |
        +-------------+-------------+
        |                           |
   [应用服务器集群]          [监控服务器]
        |
   [内网交换机]
        |
        +-------------+-------------+
        |             |             |
   [数据库集群]   [大数据集群]   [堡垒机]
```

#### **端口规划**
```
前端：80, 443
后端API：8080-8090
MySQL：3306
PostgreSQL：5432
Redis：6379
Kafka：9092
Zookeeper：2181
Hadoop NameNode：9870, 8020
YARN ResourceManager：8088
Hive：10000
Spark：8080, 7077
Flink：8081
Prometheus：9090
Grafana：3000
```

---

## 五、成本预算

### 5.1 云服务器（阿里云/腾讯云）

#### **开发环境（方案B - 3台）**
| 服务器 | 配置 | 价格/月 | 数量 | 小计 |
|--------|------|---------|------|------|
| 应用服务器 | 8C32G | 600元 | 1 | 600元 |
| 数据库服务器 | 8C32G | 600元 | 1 | 600元 |
| 大数据服务器 | 16C64G | 1200元 | 1 | 1200元 |
| 带宽 | 10Mbps | 200元 | - | 200元 |
| **合计** | - | - | - | **2600元/月** |

#### **生产环境（7台）**
| 服务器 | 配置 | 价格/月 | 数量 | 小计 |
|--------|------|---------|------|------|
| 应用服务器 | 16C64G | 1200元 | 2 | 2400元 |
| 数据库服务器 | 16C128G | 2400元 | 2 | 4800元 |
| 大数据节点 | 32C256G | 4800元 | 3 | 14400元 |
| 监控服务器 | 8C32G | 600元 | 1 | 600元 |
| 堡垒机 | 4C8G | 300元 | 1 | 300元 |
| 带宽 | 50Mbps | 1000元 | - | 1000元 |
| **合计** | - | - | - | **23500元/月** |

**年度成本**：约28万元

---

### 5.2 物理服务器（自建机房）

#### **生产环境（7台）**
| 项目 | 配置 | 单价 | 数量 | 小计 |
|------|------|------|------|------|
| 应用服务器 | Dell R740（16C64G） | 3.5万 | 2 | 7万 |
| 数据库服务器 | Dell R740（16C128G） | 5万 | 2 | 10万 |
| 大数据服务器 | Dell R750（32C256G） | 10万 | 3 | 30万 |
| 监控服务器 | Dell R640（8C32G） | 2.5万 | 1 | 2.5万 |
| 堡垒机 | Dell R340（4C8G） | 1.5万 | 1 | 1.5万 |
| 网络设备 | 交换机、路由器 | 5万 | - | 5万 |
| 机柜+PDU | 42U标准机柜 | 2万 | 1 | 2万 |
| **硬件总成本** | - | - | - | **58万** |
| 托管费用 | 机房托管 | 2000元/月 | - | 2.4万/年 |
| 电费 | 约10KW | 1500元/月 | - | 1.8万/年 |
| **年度运维成本** | - | - | - | **4.2万/年** |

**首年总成本**：约62万元  
**后续年度成本**：约4.2万元/年

---

## 六、部署顺序建议

### 阶段一：基础设施搭建（1-2周）

#### **Week 1：基础环境**
```
Day 1-2：服务器采购/开通
Day 3-4：操作系统安装与优化
  - CentOS 7.9 / Ubuntu 20.04
  - 内核参数调优
  - 防火墙配置
  - 时间同步（NTP）
Day 5-7：基础组件安装
  - JDK 1.8 / 11
  - Python 3.8+
  - Docker + Docker Compose
  - Nginx
  - Git
```

#### **Week 2：数据库与中间件**
```
Day 1-2：数据库安装
  - MySQL 8.0（主从）
  - PostgreSQL 14（主从）
  - Redis 6.x（哨兵）
Day 3-4：消息队列
  - Zookeeper集群
  - Kafka集群
Day 5-7：监控系统
  - Prometheus + Grafana
  - ELK Stack
```

---

### 阶段二：应用服务部署（2-3周）

#### **Week 3：后端服务**
```
Day 1-2：API网关与认证
  - Spring Cloud Gateway
  - OAuth2 / JWT
Day 3-4：数据源平台
  - Chat2DB部署
  - 数据源连接测试
Day 5-7：数据同步服务
  - DBSwitch部署
  - DataCap部署
```

#### **Week 4：数据集成服务**
```
Day 1-2：DataX/Transport
Day 3-4：TIS
Day 5-7：SeaTunnel
```

---

### 阶段三：大数据平台（3-4周）

#### **Week 5-6：Hadoop生态**
```
Week 5：
  - Hadoop集群（HDFS + YARN）
  - Hive安装配置
  - Zookeeper集群
Week 6：
  - Spark集群
  - Flink集群
  - 集成测试
```

#### **Week 7：OLAP与管理平台**
```
Day 1-3：ClickHouse/Doris集群
Day 4-5：DataSophon部署
Day 6-7：StreamPark部署
```

---

### 阶段四：前端与联调（1周）

#### **Week 8：前端部署与整体联调**
```
Day 1-2：前端构建部署
  - Vue 3项目打包
  - Nginx配置
  - HTTPS证书
Day 3-5：接口联调
  - 各模块API对接
  - 功能测试
Day 6-7：性能测试与优化
  - 压力测试
  - 性能调优
```

---

## 七、推荐方案总结

### 🎯 方案选择建议

#### **1. 个人学习/小团队（预算有限）**
**推荐**：开发环境方案A（单机）
- **服务器**：1台（16C64G）
- **成本**：500-800元/月
- **适用**：学习、开发、小规模测试

#### **2. 中小企业/创业公司**
**推荐**：开发环境方案B（3台）
- **服务器**：3台
- **成本**：2600元/月
- **适用**：中等规模业务、POC验证

#### **3. 大中型企业（生产环境）**
**推荐**：生产环境方案（7台）
- **服务器**：7台
- **成本**：
  - 云服务器：23500元/月（28万/年）
  - 物理服务器：62万（首年）+ 4.2万/年（运维）
- **适用**：企业生产环境、高并发、大数据量

---

## 八、优化建议

### 8.1 成本优化

#### **云服务器优化**
1. **预留实例**：购买1-3年预留实例，节省30-60%
2. **竞价实例**：非核心服务使用竞价实例，节省70%
3. **混合云**：核心服务上云，大数据处理本地化
4. **弹性伸缩**：根据业务高峰自动扩缩容

#### **架构优化**
1. **容器化**：使用Kubernetes管理，提高资源利用率
2. **服务合并**：开发环境多服务共享节点
3. **存储分层**：热数据SSD，冷数据对象存储（OSS）

---

### 8.2 性能优化

#### **网络优化**
- 使用内网通信（免费且快速）
- 数据库与应用服务器同区域部署
- 启用CDN加速前端资源

#### **存储优化**
- HDFS数据压缩（Snappy/LZ4）
- 数据库分库分表
- 冷热数据分离

---

## 九、FAQ

### Q1：可以全部使用Docker部署吗？
**A**：可以，但大数据组件（Hadoop、Spark）建议物理机部署，性能更好。应用层和数据库层可以容器化。

### Q2：需要购买商业软件吗？
**A**：文档中的组件大多是开源的，但以下可能需要商业授权：
- Oracle数据库（如需支持）
- 达梦、人大金仓等国产数据库
- 部分企业级功能

### Q3：能否先部署部分模块？
**A**：可以！建议顺序：
1. 基础设施（MySQL、Redis）
2. 前端 + 后端API
3. Chat2DB（数据源管理）
4. DBSwitch（数据同步）
5. 大数据平台（按需）

### Q4：开发环境能否升级到生产环境？
**A**：可以，但需要：
- 增加服务器数量
- 配置高可用
- 数据迁移
- 性能调优

---

## 十、联系与支持

如有疑问，请参考：
- 📖 文档：`数据中台.md`
- 💬 技术支持：联系项目负责人
- 🔧 运维手册：待补充

---

**文档版本**：v1.0  
**更新时间**：2025-01-15  
**作者**：AllData技术团队

