# DataHub åç«¯å¼€å‘å®Œæˆè¯´æ˜

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. é¡¹ç›®æ¡†æ¶æ­å»º

- âœ… Spring Boot 2.7.18 + MyBatis-Plus 3.5.5
- âœ… Mavené¡¹ç›®ç»“æ„
- âœ… ç»Ÿä¸€å“åº”ç»“æœå°è£…ï¼ˆResultã€PageResultï¼‰
- âœ… å…¨å±€å¼‚å¸¸å¤„ç†
- âœ… è·¨åŸŸé…ç½®
- âœ… MyBatis Plusåˆ†é¡µæ’ä»¶

### 2. æ•°æ®åº“è®¾è®¡

å·²è®¾è®¡å¹¶åˆ›å»ºä»¥ä¸‹æ•°æ®è¡¨ï¼š

- âœ… `sys_user` - ç”¨æˆ·è¡¨
- âœ… `datasource` - æ•°æ®æºè¡¨
- âœ… `sync_task` - æ•°æ®åº“åŒæ­¥ä»»åŠ¡è¡¨
- âœ… `query_history` - SQLæŸ¥è¯¢å†å²è¡¨
- âœ… `dataset` - æ•°æ®é›†è¡¨
- âœ… `report` - å¯è§†åŒ–æŠ¥è¡¨è¡¨ï¼ˆé¢„ç•™ï¼‰
- âœ… `dashboard_stats` - ç»Ÿè®¡æ•°æ®è¡¨ï¼ˆé¢„ç•™ï¼‰

**æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬**: `sql/datahub.sql`

### 3. ç”¨æˆ·è®¤è¯æ¨¡å—

- âœ… ç”¨æˆ·ç™»å½•æ¥å£ (`POST /api/auth/login`)
- âœ… ç”¨æˆ·ç™»å‡ºæ¥å£ (`POST /api/auth/logout`)
- âœ… è·å–ç”¨æˆ·ä¿¡æ¯ (`GET /api/auth/info`)
- âœ… JWT Tokenç”Ÿæˆå’ŒéªŒè¯
- âœ… é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼šadmin/admin123

### 4. æ•°æ®æºç®¡ç†æ¨¡å—

- âœ… åˆ†é¡µæŸ¥è¯¢æ•°æ®æº (`GET /api/datasource/page`)
- âœ… æŸ¥è¯¢æ‰€æœ‰æ•°æ®æº (`GET /api/datasource/list`)
- âœ… æ ¹æ®IDæŸ¥è¯¢æ•°æ®æº (`GET /api/datasource/{id}`)
- âœ… åˆ›å»ºæ•°æ®æº (`POST /api/datasource`)
- âœ… æ›´æ–°æ•°æ®æº (`PUT /api/datasource/{id}`)
- âœ… åˆ é™¤æ•°æ®æº (`DELETE /api/datasource/{id}`)
- âœ… æµ‹è¯•æ•°æ®æºè¿æ¥ (`POST /api/datasource/{id}/test`)

**æ”¯æŒçš„æ•°æ®åº“ç±»å‹**:
- MySQL
- PostgreSQL
- Oracle
- è¾¾æ¢¦(DM)
- äººå¤§é‡‘ä»“(KingBase)

### 5. æ•°æ®ä¸­æ¢æ¨¡å—ï¼ˆDataCapï¼‰

#### SQLæŸ¥è¯¢åŠŸèƒ½
- âœ… æ‰§è¡ŒSQLæŸ¥è¯¢ (`POST /api/datacap/query`)
- âœ… è‡ªåŠ¨è®°å½•æŸ¥è¯¢å†å²
- âœ… è¿”å›æŸ¥è¯¢ç»“æœï¼ˆåˆ—åã€æ•°æ®ã€è¡Œæ•°ã€æ‰§è¡Œæ—¶é—´ï¼‰

#### æŸ¥è¯¢å†å²ç®¡ç†
- âœ… åˆ†é¡µæŸ¥è¯¢æŸ¥è¯¢å†å² (`GET /api/datacap/history/page`)
- âœ… åˆ é™¤æŸ¥è¯¢å†å² (`DELETE /api/datacap/history/{id}`)

#### æ•°æ®é›†ç®¡ç†
- âœ… åˆ†é¡µæŸ¥è¯¢æ•°æ®é›† (`GET /api/datacap/dataset/page`)
- âœ… æ ¹æ®IDæŸ¥è¯¢æ•°æ®é›† (`GET /api/datacap/dataset/{id}`)
- âœ… åˆ›å»ºæ•°æ®é›† (`POST /api/datacap/dataset`)
- âœ… æ›´æ–°æ•°æ®é›† (`PUT /api/datacap/dataset/{id}`)
- âœ… åˆ é™¤æ•°æ®é›† (`DELETE /api/datacap/dataset/{id}`)
- âœ… åˆ·æ–°æ•°æ®é›† (`POST /api/datacap/dataset/{id}/refresh`)

### 6. æ•°æ®åº“åŒæ­¥æ¨¡å—ï¼ˆDBSwitchï¼‰

- âœ… åˆ†é¡µæŸ¥è¯¢åŒæ­¥ä»»åŠ¡ (`GET /api/sync/page`)
- âœ… æ ¹æ®IDæŸ¥è¯¢åŒæ­¥ä»»åŠ¡ (`GET /api/sync/{id}`)
- âœ… åˆ›å»ºåŒæ­¥ä»»åŠ¡ (`POST /api/sync`)
- âœ… æ›´æ–°åŒæ­¥ä»»åŠ¡ (`PUT /api/sync/{id}`)
- âœ… åˆ é™¤åŒæ­¥ä»»åŠ¡ (`DELETE /api/sync/{id}`)
- âœ… æ‰§è¡ŒåŒæ­¥ä»»åŠ¡ (`POST /api/sync/{id}/execute`)
- âœ… åœæ­¢åŒæ­¥ä»»åŠ¡ (`POST /api/sync/{id}/stop`)

**åŒæ­¥åŠŸèƒ½ç‰¹æ€§**:
- æ”¯æŒå…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥
- å®æ—¶æ˜¾ç¤ºåŒæ­¥è¿›åº¦
- æ‰¹é‡æ•°æ®æ’å…¥ï¼ˆæ¯æ‰¹1000æ¡ï¼‰
- å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡æ¥å£
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è®°å½•

### 7. é¦–é¡µçœ‹æ¿æ¨¡å—

- âœ… è·å–ç»Ÿè®¡æ•°æ® (`GET /api/dashboard/stats`)
  - æ•°æ®æºæ€»æ•°
  - åŒæ­¥ä»»åŠ¡æ€»æ•°
  - ä»Šæ—¥æŸ¥è¯¢æ¬¡æ•°
  - æ•°æ®é›†æ€»æ•°
  - è¿è¡Œä¸­çš„ä»»åŠ¡æ•°
  - ä»Šæ—¥æˆåŠŸä»»åŠ¡æ•°

### 8. ç›‘æ§å’Œç®¡ç†

- âœ… Druidæ•°æ®åº“è¿æ¥æ± ç›‘æ§ (`/api/druid`)
- âœ… SQLæ‰§è¡Œæ—¥å¿—
- âœ… æ…¢SQLç›‘æ§ï¼ˆ>2ç§’ï¼‰

## ğŸ“ é¡¹ç›®ç»“æ„

```
datahub-backend/
â”œâ”€â”€ src/main/java/com/datahub/
â”‚   â”œâ”€â”€ DataHubApplication.java          # å¯åŠ¨ç±»
â”‚   â”œâ”€â”€ common/                          # é€šç”¨ç±»
â”‚   â”œâ”€â”€ config/                          # é…ç½®ç±»
â”‚   â”œâ”€â”€ controller/                      # æ§åˆ¶å™¨ï¼ˆ6ä¸ªï¼‰
â”‚   â”œâ”€â”€ dto/                             # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ entity/                          # å®ä½“ç±»ï¼ˆ5ä¸ªï¼‰
â”‚   â”œâ”€â”€ exception/                       # å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ mapper/                          # Mapperæ¥å£ï¼ˆ5ä¸ªï¼‰
â”‚   â”œâ”€â”€ service/                         # æœåŠ¡æ¥å£ï¼ˆ4ä¸ªï¼‰
â”‚   â”œâ”€â”€ service/impl/                    # æœåŠ¡å®ç°ï¼ˆ4ä¸ªï¼‰
â”‚   â””â”€â”€ util/                            # å·¥å…·ç±»
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml                  # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ application-prod.yml             # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ sql/
â”‚   â””â”€â”€ datahub.sql                      # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ pom.xml                              # Mavené…ç½®
â”œâ”€â”€ README.md                            # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ QUICKSTART.md                        # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ start.sh                             # å¯åŠ¨è„šæœ¬
â””â”€â”€ .gitignore                           # Gitå¿½ç•¥æ–‡ä»¶
```

## ğŸ”§ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Spring Boot | 2.7.18 | æ ¸å¿ƒæ¡†æ¶ |
| MyBatis-Plus | 3.5.5 | ORMæ¡†æ¶ |
| Druid | 1.2.20 | æ•°æ®åº“è¿æ¥æ±  |
| MySQL Driver | 8.0.33 | MySQLé©±åŠ¨ |
| PostgreSQL Driver | 42.7.1 | PostgreSQLé©±åŠ¨ |
| Oracle Driver | 21.9.0.0 | Oracleé©±åŠ¨ |
| JWT | 0.11.5 | Tokenè®¤è¯ |
| Hutool | 5.8.23 | å·¥å…·ç±»åº“ |
| FastJSON | 2.0.43 | JSONå¤„ç† |
| Lombok | - | ç®€åŒ–ä»£ç  |

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **Javaæ–‡ä»¶**: çº¦40ä¸ª
- **ä»£ç è¡Œæ•°**: çº¦3000è¡Œ
- **æ¥å£æ•°é‡**: çº¦30ä¸ª
- **æ•°æ®è¡¨**: 7ä¸ª

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- JDK 11+
- Maven 3.6+
- MySQL 8.0+
- Redis 6.x+ (å¯é€‰)

### 2. æ•°æ®åº“åˆå§‹åŒ–

```bash
mysql -u root -p < sql/datahub.sql
```

### 3. ä¿®æ”¹é…ç½®

ç¼–è¾‘ `src/main/resources/application.yml`ï¼Œä¿®æ”¹æ•°æ®åº“å¯†ç ã€‚

### 4. å¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬
chmod +x start.sh
./start.sh

# æ–¹å¼äºŒï¼šä½¿ç”¨Maven
mvn spring-boot:run

# æ–¹å¼ä¸‰ï¼šæ‰“åŒ…è¿è¡Œ
mvn clean package -DskipTests
java -jar target/datahub-backend.jar
```

### 5. è®¿é—®æ¥å£

- æ¥å£åœ°å€: http://localhost:8080/api
- Druidç›‘æ§: http://localhost:8080/api/druid

## ğŸ“ APIæ¥å£ç¤ºä¾‹

### ç™»å½•

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### æŸ¥è¯¢æ•°æ®æº

```bash
curl http://localhost:8080/api/datasource/list
```

### æ‰§è¡ŒSQLæŸ¥è¯¢

```bash
curl -X POST http://localhost:8080/api/datacap/query \
  -H "Content-Type: application/json" \
  -d '{
    "datasourceId": 1,
    "sqlContent": "SELECT * FROM users LIMIT 10"
  }'
```

### åˆ›å»ºåŒæ­¥ä»»åŠ¡

```bash
curl -X POST http://localhost:8080/api/sync \
  -H "Content-Type: application/json" \
  -d '{
    "taskName": "ç”¨æˆ·æ•°æ®åŒæ­¥",
    "sourceDatasourceId": 1,
    "targetDatasourceId": 2,
    "sourceTable": "users",
    "targetTable": "users_backup",
    "syncMode": "full"
  }'
```

## ğŸ“¦ æµ‹è¯•æ•°æ®

æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ä¸­å·²åŒ…å«æµ‹è¯•æ•°æ®ï¼š

- **ç”¨æˆ·**: 1ä¸ªç®¡ç†å‘˜è´¦å·
- **æ•°æ®æº**: 3ä¸ªæµ‹è¯•æ•°æ®æº
- **åŒæ­¥ä»»åŠ¡**: 3ä¸ªæµ‹è¯•ä»»åŠ¡
- **æŸ¥è¯¢å†å²**: 3æ¡æŸ¥è¯¢è®°å½•
- **æ•°æ®é›†**: 3ä¸ªæµ‹è¯•æ•°æ®é›†
- **æŠ¥è¡¨**: 3ä¸ªæµ‹è¯•æŠ¥è¡¨

## ğŸ”œ ä¸‹ä¸€æ­¥è®¡åˆ’

### 1. å‰ç«¯å¯¹æ¥

éœ€è¦ä¿®æ”¹å‰ç«¯ä»£ç ï¼Œå°†æµ‹è¯•æ•°æ®æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨ï¼š

- [ ] ç™»å½•é¡µé¢å¯¹æ¥ç™»å½•æ¥å£
- [ ] æ•°æ®æºç®¡ç†é¡µé¢å¯¹æ¥æ•°æ®æºAPI
- [ ] æ•°æ®ä¸­æ¢é¡µé¢å¯¹æ¥SQLæŸ¥è¯¢API
- [ ] æ•°æ®åº“åŒæ­¥é¡µé¢å¯¹æ¥åŒæ­¥ä»»åŠ¡API
- [ ] é¦–é¡µçœ‹æ¿å¯¹æ¥ç»Ÿè®¡æ•°æ®API

### 2. æœ¬åœ°è”è°ƒæµ‹è¯•

- [ ] å¯åŠ¨åç«¯æœåŠ¡
- [ ] å¯åŠ¨å‰ç«¯æœåŠ¡
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ¨¡å—
- [ ] ä¿®å¤å‘ç°çš„é—®é¢˜

### 3. éƒ¨ç½²åˆ°æœåŠ¡å™¨

- [ ] æ‰“åŒ…åç«¯JARæ–‡ä»¶
- [ ] ä¸Šä¼ åˆ°åº”ç”¨æœåŠ¡å™¨
- [ ] é…ç½®ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“
- [ ] å¯åŠ¨åç«¯æœåŠ¡
- [ ] å‰åç«¯è”è°ƒæµ‹è¯•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](datahub-backend/README.md) - å®Œæ•´çš„é¡¹ç›®è¯´æ˜å’ŒAPIæ–‡æ¡£
- [QUICKSTART.md](datahub-backend/QUICKSTART.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—
- [sql/datahub.sql](datahub-backend/sql/datahub.sql) - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

## ğŸ’¡ æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**: å½“å‰ç™»å½•éªŒè¯ä½¿ç”¨æ˜æ–‡æ¯”è¾ƒï¼Œç”Ÿäº§ç¯å¢ƒåº”è¯¥ä½¿ç”¨BCryptåŠ å¯†
2. **TokenéªŒè¯**: å½“å‰æœªå®ç°å®Œæ•´çš„Tokenæ‹¦æˆªå™¨ï¼Œéœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ·»åŠ 
3. **äº‹åŠ¡ç®¡ç†**: åŒæ­¥ä»»åŠ¡æ‰§è¡Œæ—¶åº”è¯¥æ·»åŠ äº‹åŠ¡æ§åˆ¶
4. **æ€§èƒ½ä¼˜åŒ–**: å¤§æ•°æ®é‡åŒæ­¥æ—¶åº”è¯¥è€ƒè™‘åˆ†æ‰¹å¤„ç†å’Œè¿›åº¦æŒä¹…åŒ–
5. **é”™è¯¯å¤„ç†**: éœ€è¦å®Œå–„å„ç§å¼‚å¸¸æƒ…å†µçš„å¤„ç†é€»è¾‘

## ğŸ‰ æ€»ç»“

åç«¯æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å¼€å‘å®Œæˆï¼ŒåŒ…æ‹¬ï¼š

- âœ… å®Œæ•´çš„RESTful APIæ¥å£
- âœ… æ•°æ®åº“è®¾è®¡å’Œåˆå§‹åŒ–è„šæœ¬
- âœ… ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- âœ… æ•°æ®æºç®¡ç†å’Œè¿æ¥æµ‹è¯•
- âœ… SQLæŸ¥è¯¢å’Œå†å²è®°å½•
- âœ… æ•°æ®é›†ç®¡ç†
- âœ… æ•°æ®åº“åŒæ­¥åŠŸèƒ½
- âœ… ç»Ÿè®¡æ•°æ®æ¥å£
- âœ… ç›‘æ§å’Œæ—¥å¿—

ç°åœ¨å¯ä»¥å¼€å§‹å‰ç«¯å¯¹æ¥å·¥ä½œï¼Œå®ç°çœŸæ­£çš„å‰åç«¯åˆ†ç¦»åº”ç”¨ï¼

