# 🎉 AllData数据中台 - 部署方案已就绪！

## ✅ 服务器配置确认

### 已购买服务器（3台）

| 服务器 | 公网IP | 内网IP | 配置 | 用途 | 月成本 |
|--------|--------|--------|------|------|--------|
| **服务器1** | 82.156.36.157 | 10.2.4.15 | 4核8GB | 应用服务器 | 230元 |
| **服务器2** | 58.87.103.99 | 10.2.0.16 | 4核8GB | 数据库服务器 | 230元 |
| **服务器3** | 192.144.173.136 | 10.2.4.9 | 4核8GB | 大数据服务器 | 230元 |

**总成本**: 690元/月 或 7038元/年（85折）

---

## 📦 已准备的部署文件

```
/Users/liumingze/DataHub/deployment/
├── 📄 README.md                    # 完整部署文档
├── 📄 快速开始.md                   # 快速开始指南 ⭐
├── 📄 部署方案总结.md               # 本文件
├── 🔧 init-all-servers.sh          # 初始化所有服务器
├── 🔧 deploy-db.sh                 # 部署数据库服务器
├── 📁 server1-app/                 # 应用服务器配置
│   └── docker-compose.yml
├── 📁 server2-db/                  # 数据库服务器配置
│   └── docker-compose.yml
└── 📁 server3-bigdata/             # 大数据服务器配置
    └── docker-compose.yml
```

---

## 🚀 立即开始部署（3步完成）

### 方法1：快速部署（推荐）⭐

```bash
# 1. 打开终端，进入部署目录
cd /Users/liumingze/DataHub/deployment

# 2. 查看快速开始指南
open 快速开始.md

# 3. 按照指南执行命令
```

### 方法2：一键部署

```bash
# 复制以下命令，一次性完成所有部署
cd /Users/liumingze/DataHub/deployment

# 1. 配置SSH
chmod 400 ~/.ssh/lhkp-5k5yya5o.pem

cat > ~/.ssh/config <<'EOF'
Host alldata-app
    HostName 82.156.36.157
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60

Host alldata-db
    HostName 58.87.103.99
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60

Host alldata-bigdata
    HostName 192.144.173.136
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60
EOF

# 2. 测试连接
ssh alldata-app "echo '✓ 应用服务器连接成功'"
ssh alldata-db "echo '✓ 数据库服务器连接成功'"
ssh alldata-bigdata "echo '✓ 大数据服务器连接成功'"

# 3. 初始化服务器（10分钟）
./init-all-servers.sh

# 4. 部署数据库（8分钟）
./deploy-db.sh

# 5. 部署前端（5分钟）
cd /Users/liumingze/DataHub/datahub-frontend
npm run build
scp -r dist/* alldata-app:/opt/alldata/frontend/
```

---

## 📊 部署架构

### 服务器1 - 应用服务器 (82.156.36.157)

```
┌─────────────────────────────────────┐
│   应用服务器 (4核8GB)                │
├─────────────────────────────────────┤
│ ✓ Nginx (前端)          - 512MB    │
│ ✓ 后端API              - 1.5GB     │
│ ✓ Chat2DB              - 2GB       │
│ ✓ DBSwitch             - 1.5GB     │
│ ✓ DataCap              - 1.5GB     │
│ ✓ 预留                 - 1GB       │
└─────────────────────────────────────┘
```

**开放端口**:
- 80 (HTTP)
- 443 (HTTPS)
- 8080 (后端API)
- 10824 (Chat2DB)
- 9088 (DBSwitch)
- 9999 (DataCap)

---

### 服务器2 - 数据库服务器 (58.87.103.99)

```
┌─────────────────────────────────────┐
│   数据库服务器 (4核8GB)              │
├─────────────────────────────────────┤
│ ✓ MySQL 8.0            - 3GB       │
│ ✓ PostgreSQL 14        - 2GB       │
│ ✓ Redis 6.x            - 1GB       │
│ ✓ Zookeeper            - 512MB     │
│ ✓ 预留                 - 1.5GB     │
└─────────────────────────────────────┘
```

**开放端口** (仅内网):
- 3306 (MySQL)
- 5432 (PostgreSQL)
- 6379 (Redis)
- 2181 (Zookeeper)

**默认密码**: `AllData@2025`

---

### 服务器3 - 大数据服务器 (192.144.173.136)

```
┌─────────────────────────────────────┐
│   大数据服务器 (4核8GB)              │
├─────────────────────────────────────┤
│ ✓ Kafka                - 1GB       │
│ ✓ DataX/Transport      - 2GB       │
│ ✓ TIS                  - 1.5GB     │
│ ✓ SeaTunnel            - 1.5GB     │
│ ✓ 预留                 - 2GB       │
└─────────────────────────────────────┘
```

**开放端口** (仅内网):
- 9092 (Kafka)
- 8888 (DataX Web)
- 8080 (TIS)
- 8081 (SeaTunnel)

---

## 🔐 安全配置

### SSH密钥

```
密钥名称: lhkp-5k5yya5o
私钥文件: ~/.ssh/lhkp-5k5yya5o.pem
权限要求: 400 (只读)
```

### 防火墙策略

- **服务器1**: 开放80、443端口给公网，其他端口仅内网
- **服务器2**: 所有端口仅内网访问
- **服务器3**: 所有端口仅内网访问

### 默认密码

```
数据库密码: AllData@2025
前端账号: admin / admin123
```

⚠️ **部署完成后请立即修改密码！**

---

## 📈 资源使用预估

### 内存分配

| 服务器 | 系统 | 服务 | Swap | 预留 | 总计 |
|--------|------|------|------|------|------|
| 服务器1 | 1GB | 6GB | 4GB | 1GB | 8GB + 4GB Swap |
| 服务器2 | 1GB | 5.5GB | 4GB | 1.5GB | 8GB + 4GB Swap |
| 服务器3 | 1GB | 5GB | 4GB | 2GB | 8GB + 4GB Swap |

### 磁盘使用

| 服务器 | 系统 | Docker | 数据 | 日志 | 预留 | 总计 |
|--------|------|--------|------|------|------|------|
| 服务器1 | 20GB | 30GB | 30GB | 20GB | 20GB | 120GB |
| 服务器2 | 20GB | 20GB | 50GB | 20GB | 10GB | 120GB |
| 服务器3 | 20GB | 30GB | 40GB | 20GB | 10GB | 120GB |

---

## 🎯 部署时间表

| 阶段 | 任务 | 预计时间 | 状态 |
|------|------|----------|------|
| 1 | 配置SSH | 2分钟 | ⏳ 待开始 |
| 2 | 初始化服务器 | 10分钟 | ⏳ 待开始 |
| 3 | 部署数据库 | 8分钟 | ⏳ 待开始 |
| 4 | 部署前端 | 5分钟 | ⏳ 待开始 |
| 5 | 测试验证 | 5分钟 | ⏳ 待开始 |

**总计**: 约30分钟

---

## ✅ 部署检查清单

### 部署前

- [ ] SSH私钥已下载 (lhkp-5k5yya5o.pem)
- [ ] 私钥权限已设置为400
- [ ] SSH配置文件已创建
- [ ] 3台服务器连接测试通过
- [ ] 前端代码已构建 (npm run build)

### 部署中

- [ ] 服务器初始化完成
- [ ] Docker和Docker Compose已安装
- [ ] Swap已配置（4GB）
- [ ] 防火墙已配置
- [ ] 数据库服务已启动
- [ ] 前端已部署

### 部署后

- [ ] 前端可以访问 (http://82.156.36.157)
- [ ] 可以登录系统 (admin/admin123)
- [ ] MySQL可以连接
- [ ] PostgreSQL可以连接
- [ ] Redis可以连接
- [ ] 所有容器运行正常

---

## 🔄 后续优化建议

### 第1周：基础功能

1. **完善后端API**
   - 实现用户认证
   - 对接数据库
   - 实现核心业务逻辑

2. **配置监控**
   - 部署Prometheus
   - 配置Grafana
   - 设置告警规则

3. **配置备份**
   - 数据库自动备份到COS
   - 配置文件备份
   - 日志归档

### 第2周：性能优化

1. **数据库优化**
   - 索引优化
   - 查询优化
   - 连接池调优

2. **应用优化**
   - 启用CDN
   - 配置HTTPS
   - 启用Gzip压缩

3. **监控完善**
   - 性能监控
   - 业务监控
   - 日志分析

### 第3周：功能扩展

1. **大数据组件**
   - 部署Kafka
   - 配置DataX
   - 部署TIS

2. **高可用**
   - MySQL主从
   - Redis哨兵
   - 应用双活

---

## 💰 成本优化建议

### 当前成本

```
服务器: 690元/月
COS存储: 250元/月 (建议)
带宽: 包含在服务器费用中
────────────────────
总计: 940元/月 ≈ 1.13万/年
```

### 优化建议

1. **年付优惠**: 购买1年可节省15% (约1700元)
2. **COS生命周期**: 配置自动归档，节省50%存储成本
3. **CDN加速**: 使用腾讯云CDN，降低带宽成本
4. **预留实例**: 长期使用可购买预留实例

**预计优化后**: 约8000元/年

---

## 📞 获取帮助

### 文档

- 📄 完整部署文档: `README.md`
- 📄 快速开始: `快速开始.md`
- 📄 服务器配置规划: `../服务器配置规划方案.md`

### 常见问题

查看 `README.md` 中的"故障排查"章节

### 技术支持

- 查看日志: `docker logs <container_name>`
- 检查状态: `docker ps -a`
- 系统日志: `journalctl -xe`

---

## 🎉 准备就绪！

所有部署文件已准备完毕，现在可以开始部署了！

**下一步**:
1. 打开 `快速开始.md`
2. 按照步骤执行命令
3. 30分钟后即可访问系统！

**访问地址**: http://82.156.36.157  
**默认账号**: admin / admin123

祝部署顺利！🚀

---

**创建时间**: 2025-01-15  
**版本**: v1.0  
**状态**: ✅ 准备就绪

