# ðŸš€ AllDataæ•°æ®ä¸­å° - å¿«é€Ÿå¼€å§‹æŒ‡å—

## âœ… æœåŠ¡å™¨ä¿¡æ¯å·²ç¡®è®¤

```
âœ“ æœåŠ¡å™¨1: 82.156.36.157 (åº”ç”¨æœåŠ¡å™¨)
âœ“ æœåŠ¡å™¨2: 58.87.103.99 (æ•°æ®åº“æœåŠ¡å™¨)
âœ“ æœåŠ¡å™¨3: 192.144.173.136 (å¤§æ•°æ®æœåŠ¡å™¨)
âœ“ SSHå¯†é’¥: lhkp-5k5yya5o.pem
```

---

## ðŸ“‹ éƒ¨ç½²æ­¥éª¤ï¼ˆ30åˆ†é’Ÿå®Œæˆï¼‰

### ç¬¬1æ­¥ï¼šé…ç½®SSHï¼ˆ2åˆ†é’Ÿï¼‰

åœ¨ä½ çš„Macä¸Šæ‰§è¡Œï¼š

```bash
# 1. ç¡®ä¿ç§é’¥æ–‡ä»¶å­˜åœ¨
ls -la ~/.ssh/lhkp-5k5yya5o.pem

# 2. å¦‚æžœæ²¡æœ‰ï¼Œä»Žä¸‹è½½ç›®å½•ç§»åŠ¨è¿‡æ¥
mv ~/Downloads/lhkp-5k5yya5o.pem ~/.ssh/

# 3. ä¿®æ”¹æƒé™ï¼ˆå¿…é¡»ï¼ï¼‰
chmod 400 ~/.ssh/lhkp-5k5yya5o.pem

# 4. åˆ›å»ºSSHé…ç½®
cat > ~/.ssh/config <<'EOF'
Host alldata-app
    HostName 82.156.36.157
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60

Host alldata-db
    HostName 58.87.103.99
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60

Host alldata-bigdata
    HostName 192.144.173.136
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60
EOF

# 5. æµ‹è¯•è¿žæŽ¥
ssh alldata-app "echo 'âœ“ åº”ç”¨æœåŠ¡å™¨è¿žæŽ¥æˆåŠŸ'"
ssh alldata-db "echo 'âœ“ æ•°æ®åº“æœåŠ¡å™¨è¿žæŽ¥æˆåŠŸ'"
ssh alldata-bigdata "echo 'âœ“ å¤§æ•°æ®æœåŠ¡å™¨è¿žæŽ¥æˆåŠŸ'"
```

å¦‚æžœéƒ½æ˜¾ç¤º"è¿žæŽ¥æˆåŠŸ"ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼

---

### ç¬¬2æ­¥ï¼šåˆå§‹åŒ–æ‰€æœ‰æœåŠ¡å™¨ï¼ˆ10åˆ†é’Ÿï¼‰

```bash
# è¿›å…¥éƒ¨ç½²ç›®å½•
cd /Users/liumingze/DataHub/deployment

# ä¸€é”®åˆå§‹åŒ–æ‰€æœ‰æœåŠ¡å™¨
./init-all-servers.sh
```

**è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š**
- âœ… ç³»ç»Ÿæ›´æ–°
- âœ… å®‰è£…Dockerå’ŒDocker Compose
- âœ… é…ç½®é˜²ç«å¢™
- âœ… åˆ›å»º4GB Swap
- âœ… ä¼˜åŒ–å†…æ ¸å‚æ•°
- âœ… é…ç½®æ—¶é—´åŒæ­¥

**é¢„è®¡æ—¶é—´ï¼š** 10åˆ†é’Ÿ

---

### ç¬¬3æ­¥ï¼šéƒ¨ç½²æ•°æ®åº“æœåŠ¡å™¨ï¼ˆ8åˆ†é’Ÿï¼‰

```bash
# éƒ¨ç½²MySQLã€PostgreSQLã€Redisã€Zookeeper
./deploy-db.sh
```

**éƒ¨ç½²å†…å®¹ï¼š**
- âœ… MySQL 8.0ï¼ˆç«¯å£3306ï¼‰
- âœ… PostgreSQL 14ï¼ˆç«¯å£5432ï¼‰
- âœ… Redis 6.xï¼ˆç«¯å£6379ï¼‰
- âœ… Zookeeperï¼ˆç«¯å£2181ï¼‰

**é»˜è®¤å¯†ç ï¼š** `AllData@2025`

**é¢„è®¡æ—¶é—´ï¼š** 8åˆ†é’Ÿ

---

### ç¬¬4æ­¥ï¼šéƒ¨ç½²å‰ç«¯ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# åœ¨æœ¬åœ°æž„å»ºå‰ç«¯
cd /Users/liumingze/DataHub/datahub-frontend
npm run build

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -r dist/* alldata-app:/opt/alldata/frontend/

# é…ç½®Nginx
ssh alldata-app 'cat > /opt/alldata/config/nginx.conf <<EOF
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    log_format main '\''$remote_addr - $remote_user [$time_local] "$request" ''
                    '\''$status $body_bytes_sent "$http_referer" ''
                    '\''"$http_user_agent" "$http_x_forwarded_for"'\'';
    
    access_log /var/log/nginx/access.log main;
    
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    client_max_body_size 100M;
    
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml text/javascript 
               application/json application/javascript application/xml+rss 
               application/rss+xml font/truetype font/opentype 
               application/vnd.ms-fontobject image/svg+xml;
    
    server {
        listen 80;
        server_name _;
        root /usr/share/nginx/html;
        index index.html;
        
        location / {
            try_files $uri $uri/ /index.html;
        }
        
        location /api/ {
            proxy_pass http://localhost:8080/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
        
        location /chat2db/ {
            proxy_pass http://localhost:10824/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}
EOF'

# å¯åŠ¨Nginx
ssh alldata-app 'cd /opt/alldata/server1-app && docker-compose up -d nginx'
```

**é¢„è®¡æ—¶é—´ï¼š** 5åˆ†é’Ÿ

---

### ç¬¬5æ­¥ï¼šè®¿é—®ç³»ç»Ÿ

```
å‰ç«¯åœ°å€: http://82.156.36.157
é»˜è®¤è´¦å·: admin
é»˜è®¤å¯†ç : admin123
```

---

## ðŸŽ¯ å®Œæ•´éƒ¨ç½²å‘½ä»¤ï¼ˆå¤åˆ¶ç²˜è´´ï¼‰

å¦‚æžœä½ æƒ³ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰æ­¥éª¤ï¼Œå¤åˆ¶ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
#!/bin/bash

# è®¾ç½®é¢œè‰²
GREEN='\033[0;32m'
NC='\033[0m'

echo -e "${GREEN}å¼€å§‹éƒ¨ç½²AllDataæ•°æ®ä¸­å°...${NC}"

# 1. é…ç½®SSH
echo -e "${GREEN}[1/5] é…ç½®SSH...${NC}"
chmod 400 ~/.ssh/lhkp-5k5yya5o.pem

cat > ~/.ssh/config <<'EOF'
Host alldata-app
    HostName 82.156.36.157
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60

Host alldata-db
    HostName 58.87.103.99
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60

Host alldata-bigdata
    HostName 192.144.173.136
    User root
    IdentityFile ~/.ssh/lhkp-5k5yya5o.pem
    ServerAliveInterval 60
EOF

# 2. æµ‹è¯•è¿žæŽ¥
echo -e "${GREEN}[2/5] æµ‹è¯•è¿žæŽ¥...${NC}"
ssh alldata-app "echo 'âœ“ åº”ç”¨æœåŠ¡å™¨è¿žæŽ¥æˆåŠŸ'"
ssh alldata-db "echo 'âœ“ æ•°æ®åº“æœåŠ¡å™¨è¿žæŽ¥æˆåŠŸ'"
ssh alldata-bigdata "echo 'âœ“ å¤§æ•°æ®æœåŠ¡å™¨è¿žæŽ¥æˆåŠŸ'"

# 3. åˆå§‹åŒ–æœåŠ¡å™¨
echo -e "${GREEN}[3/5] åˆå§‹åŒ–æœåŠ¡å™¨...${NC}"
cd /Users/liumingze/DataHub/deployment
./init-all-servers.sh

# 4. éƒ¨ç½²æ•°æ®åº“
echo -e "${GREEN}[4/5] éƒ¨ç½²æ•°æ®åº“...${NC}"
./deploy-db.sh

# 5. æž„å»ºå¹¶éƒ¨ç½²å‰ç«¯
echo -e "${GREEN}[5/5] éƒ¨ç½²å‰ç«¯...${NC}"
cd /Users/liumingze/DataHub/datahub-frontend
npm run build
scp -r dist/* alldata-app:/opt/alldata/frontend/

echo -e "${GREEN}================================${NC}"
echo -e "${GREEN}éƒ¨ç½²å®Œæˆï¼${NC}"
echo -e "${GREEN}================================${NC}"
echo ""
echo "è®¿é—®åœ°å€: http://82.156.36.157"
echo "é»˜è®¤è´¦å·: admin"
echo "é»˜è®¤å¯†ç : admin123"
echo ""
```

---

## ðŸ“Š éƒ¨ç½²åŽæ£€æŸ¥

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡å™¨
ssh alldata-db 'docker ps'

# æ£€æŸ¥åº”ç”¨æœåŠ¡å™¨
ssh alldata-app 'docker ps'

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
ssh alldata-db 'free -h'
ssh alldata-app 'free -h'
ssh alldata-bigdata 'free -h'
```

### æµ‹è¯•æ•°æ®åº“è¿žæŽ¥

```bash
# æµ‹è¯•MySQL
ssh alldata-db 'docker exec alldata-mysql mysql -uroot -pAllData@2025 -e "SHOW DATABASES;"'

# æµ‹è¯•PostgreSQL
ssh alldata-db 'docker exec alldata-postgresql psql -U postgres -c "\l"'

# æµ‹è¯•Redis
ssh alldata-db 'docker exec alldata-redis redis-cli -a AllData@2025 ping'
```

---

## ðŸ”§ å¸¸è§é—®é¢˜

### 1. SSHè¿žæŽ¥å¤±è´¥

```bash
# æ£€æŸ¥ç§é’¥æƒé™
ls -la ~/.ssh/lhkp-5k5yya5o.pem
# åº”è¯¥æ˜¾ç¤º: -r-------- (400)

# å¦‚æžœä¸å¯¹ï¼Œä¿®æ”¹æƒé™
chmod 400 ~/.ssh/lhkp-5k5yya5o.pem
```

### 2. DockeræœåŠ¡æœªå¯åŠ¨

```bash
ssh alldata-db 'systemctl status docker'
ssh alldata-db 'systemctl start docker'
```

### 3. å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
ssh alldata-db 'docker logs alldata-mysql'

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
ssh alldata-db 'docker ps -a'
```

### 4. å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
ssh alldata-db 'free -h'

# æŸ¥çœ‹Swap
ssh alldata-db 'swapon --show'

# æ¸…ç†Dockerç¼“å­˜
ssh alldata-db 'docker system prune -af'
```

---

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æžœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**
```bash
ssh alldata-db 'docker logs alldata-mysql'
ssh alldata-app 'docker logs alldata-nginx'
```

2. **æ£€æŸ¥é˜²ç«å¢™**
```bash
ssh alldata-db 'firewall-cmd --list-all'
```

3. **æ£€æŸ¥ç«¯å£å ç”¨**
```bash
ssh alldata-db 'netstat -tlnp | grep 3306'
```

---

## ðŸŽ‰ éƒ¨ç½²æˆåŠŸåŽ

è®¿é—®ç³»ç»Ÿï¼š
- **å‰ç«¯**: http://82.156.36.157
- **è´¦å·**: admin
- **å¯†ç **: admin123

å¼€å§‹ä½¿ç”¨AllDataæ•°æ®ä¸­å°ï¼

---

**åˆ›å»ºæ—¶é—´**: 2025-01-15  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: å‡†å¤‡å°±ç»ª âœ…

